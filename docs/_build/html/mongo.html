
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pyg.mongo &#8212; pyg 0.0.1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pyg.timeseries" href="timeseries.html" />
    <link rel="prev" title="pyg.base" href="base.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="pyg-mongo">
<h1>pyg.mongo<a class="headerlink" href="#pyg-mongo" title="Permalink to this headline">¶</a></h1>
<p>A few words on MongoDB, a no-SQL database versus SQL:</p>
<ul class="simple">
<li><p>Mongo has ‘collections’ that are the equivalent of tables</p></li>
<li><p>Mongo will refer to ‘documents’ instead of traditional records. Those records are unstructured and look like trees: dicts of dicts. They contain arbitary objects as well as just the primary types a SQL database is designed to support.</p></li>
<li><p>Mongo collections do not have the concept of primary keys</p></li>
<li><p>Mongo WHERE SQL clause is replaced by a query in a form of a dict “presented” to the collection object.</p></li>
<li><p>Mongo SELECT SQL clause is replaced by a ‘projection’ on the cursor, specifying what fields are retrieved.</p></li>
</ul>
<div class="section" id="query-generator">
<h2>Query generator<a class="headerlink" href="#query-generator" title="Permalink to this headline">¶</a></h2>
<p>We start by simplifying the way we generate mongo query dictionaries.</p>
<div class="section" id="q-and-q">
<h3>q and Q<a class="headerlink" href="#q-and-q" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt id="pyg.mongo._q.Q">
<em class="property">class </em><code class="sig-prename descclassname">pyg.mongo._q.</code><code class="sig-name descname">Q</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">keys</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._q.Q" title="Permalink to this definition">¶</a></dt>
<dd><p>The MongoDB interface for query of a collection (table) is via a creation of a complicated looking dict:
<a class="reference external" href="https://docs.mongodb.com/manual/tutorial/query-documents/">https://docs.mongodb.com/manual/tutorial/query-documents/</a></p>
<p>This is rather complicated for the average user so Q simplifies it greatly.
Q is based on TinyDB and users of TinyDB will recognise it. 
<a class="reference external" href="https://tinydb.readthedocs.io/en/latest/usage.html">https://tinydb.readthedocs.io/en/latest/usage.html</a></p>
<p>q is the singleton of Q.</p>
<p>q supports both <em>calling</em> to generate the querying dict</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># {&quot;$and&quot;: [{&quot;a&quot;: {&quot;$eq&quot;: 1}}, {&quot;b&quot;: {&quot;$eq&quot;: 2}}]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># {&quot;$or&quot;: [{&quot;a&quot;: {&quot;$eq&quot;: 1}}, {&quot;b&quot;: {&quot;$eq&quot;: 2}}]}</span>
</pre></div>
</div>
<p>or indeed</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span>  <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="n">q</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">re</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$in&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;$and&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}},</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$gt&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}}]}</span>  <span class="c1"># a in [1,2] and b greater than 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^hello&#39;</span><span class="p">)))</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;regex&#39;</span><span class="p">:</span> <span class="s1">&#39;^hello&#39;</span><span class="p">}}</span>     <span class="c1"># a regex query using regex expressions    </span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">exists</span> <span class="o">+</span> <span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">not_exists</span><span class="p">)</span>  <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;$and&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$exists&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">}},</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$exists&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">}}]}</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">dict</span><span class="p">(</span><span class="o">~</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>  <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;$not&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$eq&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}}}</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="tables-in-mongo">
<h2>Tables in Mongo<a class="headerlink" href="#tables-in-mongo" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mongo-cursor">
<h3>mongo_cursor<a class="headerlink" href="#mongo-cursor" title="Permalink to this headline">¶</a></h3>
<p>mongo_cursor has hybrid functionality of a Mongo cursor and Mongo collection objects.</p>
<dl class="py class">
<dt id="pyg.mongo._cursor.mongo_cursor">
<em class="property">class </em><code class="sig-prename descclassname">pyg.mongo._cursor.</code><code class="sig-name descname">mongo_cursor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cursor</span></em>, <em class="sig-param"><span class="n">writer</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">reader</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">query</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">_</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor" title="Permalink to this definition">¶</a></dt>
<dd><p>mongo_cursor is a souped-up combination of mongo.Cursor and mongo.Collection with a simple API.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>cursor : MongoDB cursor or MongoDB collection</p>
<dl>
<dt>writer<span class="classifier">True/False/string, optional</span></dt><dd><p>The default is None.</p>
<p>writer determines how data is written onto Mongo. MongoDB is great for manipulating/searching dict keys/values. 
If set to None, dataframes will be converted seamlessly to bytes and stored in MongoDB. Most often, this is fine.</p>
<p>At times, the actual dataframes in each doc, we may want to save in a file system. This may be because:
- The DataFrames are stored as bytes in MongoDB anyway, so they are not searchable
- Storing in files allows other non-python/non-MongoDB users easier access, allowing data to be detached from app
- MongoDB free version has limitations on size of document
- file based system may be faster
- for data licensing issues, data must not sit on servers but stored on local computer</p>
<p>Therefore, if you set writer to .csv or .parquet, dataframes within will be saved to files first and we store in mongo references to these files.</p>
<p>For this to work, you need to tell us WHERE to store each document and this is how it works: If your document are primary-keyed by name, surname. Then…
you can set the root centrally using expression like writer = ‘c:/%name%surname.parquet’</p>
<p>Alternatively, writer = ‘.parquet’ will encode only documents for which a ‘root’ key exists. This defers the decision of how to store itself to the cell.</p>
</dd>
<dt>reader<span class="classifier">callable or None, optional</span></dt><dd><p>The default is None, using decode. Use reader = False to passthru</p>
</dd>
<dt>query<span class="classifier">dict, optional</span></dt><dd><p>This is used to specify the Mongo query, e.g. q.a==1.</p>
</dd>
</dl>
<p><a href="#id1"><span class="problematic" id="id2">**</span></a>_ :</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
<p>## insert some data</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">dictable</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">*</span> <span class="n">dictable</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Filtering</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span> <span class="o">==</span> <span class="mi">25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">exc</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="mi">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">b</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">))</span> <span class="o">==</span> <span class="mi">6</span> <span class="c1">## can chain queries as well as use q to create complicated expressions</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Roww access</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>{‘_id’: ObjectId(‘603aec85cd15e2c090c07b87’), ‘a’: 0, ‘b’: 0}</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="p">[::]</span> <span class="o">-</span> <span class="s1">&#39;_id&#39;</span> <span class="o">==</span> <span class="n">dictable</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span> <span class="o">-</span> <span class="s1">&#39;_id&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dictable</span><span class="p">[</span><span class="mi">25</span> <span class="n">x</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">|</span><span class="n">b</span><span class="o">|</span><span class="n">c</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mi">0</span><span class="o">|</span><span class="mi">0</span><span class="o">|</span><span class="mi">0</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mi">0</span><span class="o">|</span><span class="mi">1</span><span class="o">|</span><span class="mi">0</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mi">0</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">0</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span><span class="mi">25</span> <span class="n">rows</span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">8</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">|</span><span class="mi">3</span><span class="o">|</span><span class="mi">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">4</span><span class="o">|</span><span class="mi">4</span><span class="o">|</span><span class="mi">16</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Column access</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="p">[[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]]</span>  <span class="c1">## just columns &#39;a&#39; and &#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">cursor</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="c1">## delete all c</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cursor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">cursor</span><span class="o">.</span><span class="n">find_one</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="mi">6</span>
</pre></div>
</div>
<p>Since mongo_cursor is too powerful, we also have a mongo_reader version which is read-only.</p>
<dl class="py method">
<dt id="pyg.mongo._cursor.mongo_cursor.delete_many">
<code class="sig-name descname">delete_many</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.delete_many" title="Permalink to this definition">¶</a></dt>
<dd><p>Equivalent to drop: deletes all documents the cursor currently points to.</p>
<dl class="field-list simple">
<dt class="field-odd">Note</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>If you want to drop a subset of the data, then use c.find(criteria).delete_many()</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>itself</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._cursor.mongo_cursor.delete_one">
<code class="sig-name descname">delete_one</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.delete_one" title="Permalink to this definition">¶</a></dt>
<dd><p>drops a specific record after verifying exactly one exists.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p><a href="#id3"><span class="problematic" id="id4">*</span></a>args : query
<a href="#id5"><span class="problematic" id="id6">**</span></a>kwargs : query</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>itself</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._cursor.mongo_cursor.drop">
<code class="sig-name descname">drop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.drop" title="Permalink to this definition">¶</a></dt>
<dd><p>Equivalent to drop: deletes all documents the cursor currently points to.</p>
<dl class="field-list simple">
<dt class="field-odd">Note</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>If you want to drop a subset of the data, then use c.find(criteria).delete_many()</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>itself</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._cursor.mongo_cursor.insert_many">
<code class="sig-name descname">insert_many</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">table</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.insert_many" title="Permalink to this definition">¶</a></dt>
<dd><p>inserts multiple documents into the collection</p>
<dl class="simple">
<dt>table<span class="classifier">sequence of documents</span></dt><dd><p>list of dicts or dictable</p>
</dd>
</dl>
<p>mongo_cursor</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>simple insertion</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="n">dictable</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,],</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[::]</span>        
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dictable</span><span class="p">[</span><span class="mi">4</span> <span class="n">x</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_id</span>                     <span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bdd</span><span class="o">|</span><span class="mi">1</span><span class="o">|</span><span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bde</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bdf</span><span class="o">|</span><span class="mi">3</span><span class="o">|</span><span class="mi">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77be0</span><span class="o">|</span><span class="mi">4</span><span class="o">|</span><span class="mi">8</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>update</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">t</span><span class="p">[::]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">modified</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">modified</span><span class="p">)</span>
</pre></div>
</div>
<p>Since each of the documents we uploaded already has an _id…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">[::]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dictable</span><span class="p">[</span><span class="mi">4</span> <span class="n">x</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_id</span>                     <span class="o">|</span><span class="n">a</span><span class="o">|</span><span class="n">b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bdd</span><span class="o">|</span><span class="mi">1</span><span class="o">|</span><span class="mi">25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bde</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">36</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77bdf</span><span class="o">|</span><span class="mi">3</span><span class="o">|</span><span class="mi">49</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">602</span><span class="n">daee68c336f6429a77be0</span><span class="o">|</span><span class="mi">4</span><span class="o">|</span><span class="mi">64</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._cursor.mongo_cursor.insert_one">
<code class="sig-name descname">insert_one</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">doc</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.insert_one" title="Permalink to this definition">¶</a></dt>
<dd><p>inserts/updates a single document.</p>
<p>If the document ALREADY has _id in it, it updates that document
If the document has no _id in it, it inserts it as a new document</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>doc<span class="classifier">dict</span></dt><dd><p>document.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="n">dictable</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,],</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>used to update an existing document</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s2">&quot;{&#39;_id&#39;: ObjectId(&#39;602d36150a5cd32717323197&#39;), &#39;a&#39;: 1, &#39;b&#39;: 5, &#39;c&#39;: 8}&quot;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>        
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">doc</span>        
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>used to insert</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._cursor.mongo_cursor.raw">
<em class="property">property </em><code class="sig-name descname">raw</code><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.raw" title="Permalink to this definition">¶</a></dt>
<dd><p>returns an unfiltered mongo_reader</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._cursor.mongo_cursor.set">
<code class="sig-name descname">set</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.set" title="Permalink to this definition">¶</a></dt>
<dd><p>updates all documents in current cursor based on the kwargs. 
It is similar to update_many but supports also functions</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>kwargs: dict of values to be updated</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_table</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">values</span> <span class="o">=</span> <span class="n">dictable</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,],</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span><span class="p">[::]</span><span class="o">-</span><span class="s1">&#39;_id&#39;</span> <span class="o">==</span> <span class="n">values</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span><span class="p">[::]</span><span class="o">-</span><span class="s1">&#39;_id&#39;</span> <span class="o">==</span> <span class="n">values</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span><span class="p">[::]</span><span class="o">-</span><span class="s1">&#39;_id&#39;</span> <span class="o">==</span> <span class="n">values</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)(</span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>itself</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._cursor.mongo_cursor.update_many">
<code class="sig-name descname">update_many</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">doc</span></em>, <em class="sig-param"><span class="n">upsert</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.update_many" title="Permalink to this definition">¶</a></dt>
<dd><p>updates all documents in current cursor based on the doc. The two are equivalent:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cursot</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">collection</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span><span class="n">cursor</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="p">{</span> <span class="s1">&#39;set&#39;</span> <span class="p">:</span> <span class="n">update</span><span class="p">})</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>doc : dict of values to be updated</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>itself</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._cursor.mongo_cursor.update_one">
<code class="sig-name descname">update_one</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">doc</span></em>, <em class="sig-param"><span class="n">upsert</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._cursor.mongo_cursor.update_one" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li><p>updates a document if an _id is present in doc.</p></li>
<li><p>insert a document if an _id is not present and upsert is true</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>doc<span class="classifier">document</span></dt><dd><p>doc to be upserted.</p>
</dd>
<dt>upsert<span class="classifier">bool, optional</span></dt><dd><p>insert if no document present? The default is True.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>doc</dt><dd><p>document updated.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="mongo-reader">
<h3>mongo_reader<a class="headerlink" href="#mongo-reader" title="Permalink to this headline">¶</a></h3>
<p>mongo_reader is a read-only version of the cursor to avoid any unintentional damage to database.</p>
<dl class="py class">
<dt id="pyg.mongo._reader.mongo_reader">
<em class="property">class </em><code class="sig-prename descclassname">pyg.mongo._reader.</code><code class="sig-name descname">mongo_reader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cursor</span></em>, <em class="sig-param"><span class="n">writer</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">reader</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">query</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">_</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader" title="Permalink to this definition">¶</a></dt>
<dd><p>mongo_reader is a read-only version of the mongo_cursor. 
You can instantiate it with a mongo_reader(cursor) call where cursor can be a mongo_cursor, a pymongo.Cursor or a pymongo.Collection</p>
<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.address">
<em class="property">property </em><code class="sig-name descname">address</code><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.address" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>tuple</dt><dd><p>A unique combination of the client addres, database name and collection name, identifying the collection uniquely.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.clone">
<code class="sig-name descname">clone</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">params</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.clone" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>mongo_reader</dt><dd><p>Returns a cloned version of current mongo_reader but allows additional parameters to be set (see spec and project)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.collection">
<em class="property">property </em><code class="sig-name descname">collection</code><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.collection" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>pymongo.Collection object</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.count">
<code class="sig-name descname">count</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.count" title="Permalink to this definition">¶</a></dt>
<dd><p>cursor.count() and len(cursor) are the same and return the number of documents matching current specification.</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.distinct">
<code class="sig-name descname">distinct</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.distinct" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the distinct values of the key</p>
<dl class="simple">
<dt>key<span class="classifier">str</span></dt><dd><p>a key in the documents.</p>
</dd>
</dl>
<dl class="simple">
<dt>list of strings</dt><dd><p>distinct values</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pymongo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;abrahams&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">39</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2000</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2020</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;cohen&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_reader</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">t</span><span class="o">.</span><span class="n">distinct</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="s1">&#39;charlie&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.docs">
<code class="sig-name descname">docs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">doc</span><span class="o">=</span><span class="default_value">'doc'</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">keys</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.docs" title="Permalink to this definition">¶</a></dt>
<dd><p>self[::] flattens the entire document.
At times, we want to see the full documents, indexed by keys and docs does that.        
returns a dictable with both keys and the document in the ‘doc’ column</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.exc">
<code class="sig-name descname">exc</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.exc" title="Permalink to this definition">¶</a></dt>
<dd><p>filters ‘negatively’ removing documents that match the criteria specified.</p>
<dl class="simple">
<dt>cursor</dt><dd><p>filtered documents.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pymongo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;abrahams&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">39</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2000</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2020</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;cohen&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_reader</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">exc</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span>        
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">exc</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="s1">&#39;barbara&#39;</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">1</span>        
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.find">
<code class="sig-name descname">find</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.find" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as self.specify()</p>
<p>The ‘spec’ is the cursor’s filter on documents (can think of it as row-selection) within the collection.
We use q (see pyg.mongo._q.q) to specify the filter on the cursor.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>A filtered mongo_reader cursor</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pymongo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;abrahams&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">39</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2000</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2020</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;cohen&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_reader</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">marriage</span><span class="o">&lt;</span><span class="n">dt</span><span class="p">(</span><span class="mi">2010</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.find_one">
<code class="sig-name descname">find_one</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">doc</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.find_one" title="Permalink to this definition">¶</a></dt>
<dd><p>searches for records based either on the doc, or the args/kwargs specified.
Unlike mongo cursor which finds one of many, here, when we ask for find_one, we will throw an exception if more than one documents are found.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<blockquote>
<div><p>A cursor pointing to a single record (document)</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.inc">
<code class="sig-name descname">inc</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.inc" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as self.specify()</p>
<p>The ‘spec’ is the cursor’s filter on documents (can think of it as row-selection) within the collection.
We use q (see pyg.mongo._q.q) to specify the filter on the cursor.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>A filtered mongo_reader cursor</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">pymongo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span> <span class="o">=</span> <span class="n">pymongo</span><span class="o">.</span><span class="n">MongoClient</span><span class="p">()[</span><span class="s1">&#39;test&#39;</span><span class="p">][</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;abrahams&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">39</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2000</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;barbara&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">marriage</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="mi">2020</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;cohen&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">mongo_reader</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alan&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">25</span><span class="p">,</span> <span class="n">q</span><span class="o">.</span><span class="n">marriage</span><span class="o">&lt;</span><span class="n">dt</span><span class="p">(</span><span class="mi">2010</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">table</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.project">
<code class="sig-name descname">project</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">projection</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.project" title="Permalink to this definition">¶</a></dt>
<dd><p>The ‘projection’ is the cursor’s column selection on documents. If in SQL we write SELECT col1, col2 FROM …, in Mongo, the cursor.projection = [‘col1’, ‘col2’]</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>projection: a list/str of keys we are interested in reading. Note that nested keys are OK: ‘level1.level2.name’ is perfectly good</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>A mongo_reader cursor filtered to read just these keys</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.projection">
<em class="property">property </em><code class="sig-name descname">projection</code><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.projection" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<blockquote>
<div><p>The ‘projection’ is the cursor’s column selection on documents. If in SQL we write SELECT col1, col2 FROM …, in Mongo, the cursor.projection = [‘col1’, ‘col2’]</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.raw">
<em class="property">property </em><code class="sig-name descname">raw</code><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.raw" title="Permalink to this definition">¶</a></dt>
<dd><p>returns an unfiltered mongo_reader</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.read">
<code class="sig-name descname">read</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">item</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">reader</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.read" title="Permalink to this definition">¶</a></dt>
<dd><p>reads the next document from the collection.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>item<span class="classifier">int, optional</span></dt><dd><p>Please read the ith record. The default is 0.</p>
</dd>
<dt>reader<span class="classifier">callable/list of callables, optional</span></dt><dd><p>When we read the document from the collection, we first transform them. 
The default behaviour is to use pyg.base._encode.decode but you may pass reader = False to grab the raw data from mongo</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>document</dt><dd><p>The document from Mongo</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.sort">
<code class="sig-name descname">sort</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">by</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.sort" title="Permalink to this definition">¶</a></dt>
<dd><p>sorting on server side, per key(s)</p>
<p>by : str/list of strs</p>
<p>sorted cursor.</p>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.spec">
<em class="property">property </em><code class="sig-name descname">spec</code><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.spec" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<blockquote>
<div><p>The ‘spec’ is the cursor’s filter on documents (can think of it as row-selection) within the collection</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._reader.mongo_reader.specify">
<code class="sig-name descname">specify</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._reader.mongo_reader.specify" title="Permalink to this definition">¶</a></dt>
<dd><p>The ‘spec’ is the cursor’s filter on documents (can think of it as row-selection) within the collection.
We use q (see pyg.mongo._q.q) to specify the filter on the cursor.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>A filtered mongo_reader cursor</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="mongo-pk-reader">
<h3>mongo_pk_reader<a class="headerlink" href="#mongo-pk-reader" title="Permalink to this headline">¶</a></h3>
<p>mongo_pk_reader extends the standard reader to handle tables with primary keys (pk) while being read-only.</p>
<dl class="py class">
<dt id="pyg.mongo._pk_reader.mongo_pk_reader">
<em class="property">class </em><code class="sig-prename descclassname">pyg.mongo._pk_reader.</code><code class="sig-name descname">mongo_pk_reader</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cursor</span></em>, <em class="sig-param"><span class="n">pk</span></em>, <em class="sig-param"><span class="n">writer</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">reader</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">query</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">_</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._pk_reader.mongo_pk_reader" title="Permalink to this definition">¶</a></dt>
<dd><p>we set up a system in Mongo to ensure we can mimin tables with primary keys. 
The way we do this is two folds:</p>
<blockquote>
<div><ul class="simple">
<li><p>At document insertion, we mark as _deleted old documents sharing the same keys by adding a key _deleted to the old doc</p></li>
<li><p>At reading, we filter for documents where q._deleted.not_exists.</p></li>
</ul>
</div></blockquote>
<dl class="py method">
<dt id="pyg.mongo._pk_reader.mongo_pk_reader.clone">
<code class="sig-name descname">clone</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._pk_reader.mongo_pk_reader.clone" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>mongo_reader</dt><dd><p>Returns a cloned version of current mongo_reader but allows additional parameters to be set (see spec and project)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._pk_reader.mongo_pk_reader.create_index">
<code class="sig-name descname">create_index</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">keys</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._pk_reader.mongo_pk_reader.create_index" title="Permalink to this definition">¶</a></dt>
<dd><p>creates a sorted index on the collection</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt><a href="#id7"><span class="problematic" id="id8">*</span></a>keys<span class="classifier">strings</span></dt><dd><p>if misssing, use the primary keys.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._pk_reader.mongo_pk_reader.dedup">
<code class="sig-name descname">dedup</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._pk_reader.mongo_pk_reader.dedup" title="Permalink to this definition">¶</a></dt>
<dd><p>Although in principle, if a single process reads/writes to Mongo, we should not get duplicates. 
In practice, when multiple clients access the database, we occasionally get multiple records with the same primary keys.
When this happens, we also end up with poor mongo _ids</p>
<dl class="simple">
<dt>mongo_pk_cursor</dt><dd><p>Hopefully, a table with unique keys.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="pyg.mongo._pk_reader.mongo_pk_reader.docs">
<code class="sig-name descname">docs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">doc</span><span class="o">=</span><span class="default_value">'doc'</span></em>, <em class="sig-param"><span class="o">*</span><span class="n">keys</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._pk_reader.mongo_pk_reader.docs" title="Permalink to this definition">¶</a></dt>
<dd><p>self[::] flattens the entire document.
At times, we want to see the full documents, indexed by keys and docs does that.        
returns a dictable with both keys and the document in the ‘doc’ column</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="mongo-pk-cursor">
<h3>mongo_pk_cursor<a class="headerlink" href="#mongo-pk-cursor" title="Permalink to this headline">¶</a></h3>
<p>mongo_pk_cursor is our go-to object and it manages all our primary-keyed tables.
.. autoclass:: pyg.mongo._pk_cursor.mongo_pk_cursor</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">members</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="encoding-docs-before-saving-to-mongo">
<h2>encoding docs before saving to mongo<a class="headerlink" href="#encoding-docs-before-saving-to-mongo" title="Permalink to this headline">¶</a></h2>
<p>Before we save data to Mongo, we may need to transform it, especially if we are to save pd.DataFrame. By default, we encode them into bytes and push to mongo.
You can choose to save pandas dataframes/series as .parquet files and numpy arrays into .npy files.</p>
<div class="section" id="parquet-write">
<h3>parquet_write<a class="headerlink" href="#parquet-write" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="pyg.mongo._encoders.parquet_write">
<code class="sig-prename descclassname">pyg.mongo._encoders.</code><code class="sig-name descname">parquet_write</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">doc</span></em>, <em class="sig-param"><span class="n">root</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._encoders.parquet_write" title="Permalink to this definition">¶</a></dt>
<dd><p>MongoDB is great for manipulating/searching dict keys/values. 
However, the actual dataframes in each doc, we may want to save in a file system. 
- The DataFrames are stored as bytes in MongoDB anyway, so they are not searchable
- Storing in files allows other non-python/non-MongoDB users easier access, allowing data to be detached from app
- MongoDB free version has limitations on size of document
- file based system may be faster, especially if saved locally not over network
- for data licensing issues, data must not sit on servers but stored on local computer</p>
<p>Therefore, the doc encode will cycle through the elements in the doc. Each time it sees a pd.DataFrame/pd.Series, it will 
- determine where to write it (with the help of the doc)
- save it to a .parquet file</p>
</dd></dl>

</div>
<div class="section" id="csv-write">
<h3>csv_write<a class="headerlink" href="#csv-write" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="pyg.mongo._encoders.csv_write">
<code class="sig-prename descclassname">pyg.mongo._encoders.</code><code class="sig-name descname">csv_write</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">doc</span></em>, <em class="sig-param"><span class="n">root</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._encoders.csv_write" title="Permalink to this definition">¶</a></dt>
<dd><p>MongoDB is great for manipulating/searching dict keys/values. 
However, the actual dataframes in each doc, we may want to save in a file system. 
- The DataFrames are stored as bytes in MongoDB anyway, so they are not searchable
- Storing in files allows other non-python/non-MongoDB users easier access, allowing data to be detached from orignal application
- MongoDB free version has limitations on size of document
- file based system may be faster, especially if saved locally not over network
- for data licensing issues, data must not sit on servers but stored on local computer</p>
<p>Therefore, the doc encode will cycle through the elements in the doc. Each time it sees a pd.DataFrame/pd.Series, it will 
- determine where to write it (with the help of the doc)
- save it to a .csv file</p>
</dd></dl>

</div>
</div>
<div class="section" id="cells-in-mongo">
<h2>cells in Mongo<a class="headerlink" href="#cells-in-mongo" title="Permalink to this headline">¶</a></h2>
<p>Now that we have a database, we construct cells that can load/save data to collections.</p>
<div class="section" id="db-cell">
<h3>db_cell<a class="headerlink" href="#db-cell" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt id="pyg.mongo._db_cell.db_cell">
<em class="property">class </em><code class="sig-prename descclassname">pyg.mongo._db_cell.</code><code class="sig-name descname">db_cell</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">db</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_cell" title="Permalink to this definition">¶</a></dt>
<dd><p>a db_cell is a specialized cell with a ‘db’ member pointing to a database where cell is to be stored.    
We use this to implement save/load for the cell.</p>
<p>It is important to recognize the duality in the design:
- the job of the cell.db is to be able to save/load based on the primary keys.
- the job of the cell is to provide the primary keys to the db object.</p>
<p>The cell saves itself by ‘presenting’ itself to cell.db() and say… go on, load my data based on my keys.</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p>saving &amp; loading</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">people</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">mongo_table</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">pk</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">anna</span> <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">db</span> <span class="o">=</span> <span class="n">people</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;anna&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;abramzon&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">46</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span>  <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">db</span> <span class="o">=</span> <span class="n">people</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;bob&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">james</span> <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">db</span> <span class="o">=</span> <span class="n">people</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;james&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;johnson&#39;</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">39</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we can pull the data directly from the database</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">people</span><span class="p">()[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">][::]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dictable</span><span class="p">[</span><span class="mi">3</span> <span class="n">x</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_id</span>                     <span class="o">|</span><span class="n">age</span><span class="o">|</span><span class="n">name</span> <span class="o">|</span><span class="n">surname</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e732</span><span class="n">e0ef13bec9cd8a6cb</span><span class="o">|</span><span class="mi">39</span> <span class="o">|</span><span class="n">james</span><span class="o">|</span><span class="n">johnson</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e73</span><span class="n">db0ef13bec9cd8a6d4</span><span class="o">|</span><span class="mi">46</span> <span class="o">|</span><span class="n">anna</span> <span class="o">|</span><span class="n">abramzon</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e73</span><span class="n">db0ef13bec9cd8a6d7</span><span class="o">|</span><span class="mi">25</span> <span class="o">|</span><span class="n">bob</span>  <span class="o">|</span><span class="n">brown</span>       
</pre></div>
</div>
<p>db_cell can implement a function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">is_young</span><span class="p">(</span><span class="n">age</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="k">return</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">30</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">is_young</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob</span> <span class="o">=</span> <span class="n">bob</span><span class="o">.</span><span class="n">go</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">bob</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">True</span>
</pre></div>
</div>
<p>When run, it saves its new data to Mongo and we can load its own data:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_cell_with_just_db_and_keys</span> <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">db</span> <span class="o">=</span> <span class="n">people</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;bob&#39;</span><span class="p">,</span> <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;brown&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="s1">&#39;age&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_cell_with_just_db_and_keys</span> 
<span class="gp">&gt;&gt;&gt; </span><span class="n">now_with_the_data_from_database</span> <span class="o">=</span> <span class="n">new_cell_with_just_db_and_keys</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">now_with_the_data_from_database</span><span class="o">.</span><span class="n">age</span> <span class="o">==</span> <span class="mi">25</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">people</span><span class="p">()[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;surname&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">][::]</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">dictable</span><span class="p">[</span><span class="mi">3</span> <span class="n">x</span> <span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_id</span>                     <span class="o">|</span><span class="n">age</span><span class="o">|</span><span class="n">name</span> <span class="o">|</span><span class="n">surname</span> <span class="o">|</span><span class="n">data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e732</span><span class="n">e0ef13bec9cd8a6cb</span><span class="o">|</span><span class="mi">39</span> <span class="o">|</span><span class="n">james</span><span class="o">|</span><span class="n">johnson</span> <span class="o">|</span><span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e73</span><span class="n">db0ef13bec9cd8a6d4</span><span class="o">|</span><span class="mi">46</span> <span class="o">|</span><span class="n">anna</span> <span class="o">|</span><span class="n">abramzon</span><span class="o">|</span><span class="kc">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">601e73</span><span class="n">db0ef13bec9cd8a6d7</span><span class="o">|</span><span class="mi">25</span> <span class="o">|</span><span class="n">bob</span>  <span class="o">|</span><span class="n">brown</span>   <span class="o">|</span><span class="kc">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">people</span><span class="p">()</span><span class="o">.</span><span class="n">raw</span><span class="o">.</span><span class="n">drop</span><span class="p">()</span>    
</pre></div>
</div>
<dl class="py method">
<dt id="pyg.mongo._db_cell.db_cell.load">
<code class="sig-name descname">load</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">keys</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_cell.load" title="Permalink to this definition">¶</a></dt>
<dd><p>loads a document from the database and updates various keys</p>
<dl class="simple">
<dt>mode<span class="classifier">int , optional</span></dt><dd><p>if -1, then does not load and skips this function
if 0, then will load if found. If not found, will return original document
if 1, then will throw an exception if no document is found in the database
The default is 0.</p>
</dd>
<dt>keys<span class="classifier">str/list of str/True, optional</span></dt><dd><p>determines which additional keys (other than output) are loaded onto the existing cell from the saved one. output keys are always loaded.</p>
</dd>
</dl>
<p>document</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="periodic-cell">
<h3>periodic_cell<a class="headerlink" href="#periodic-cell" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt id="pyg.mongo._periodic_cell.periodic_cell">
<em class="property">class </em><code class="sig-prename descclassname">pyg.mongo._periodic_cell.</code><code class="sig-name descname">periodic_cell</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">function</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">output</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">db</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">_period</span><span class="o">=</span><span class="default_value">'1b'</span></em>, <em class="sig-param"><span class="n">updated</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._periodic_cell.periodic_cell" title="Permalink to this definition">¶</a></dt>
<dd><p>periodic_cell inherits from db_cell its ability to save itself in MongoDb using its db members
Its calculation schedule depends on when it was last updated.</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">periodic_cell</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>We now assert it needs to be calculated and calculate it…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">go</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let us cheat and tell it, it was last run 3 days ago…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">updated</span> <span class="o">=</span> <span class="n">dt</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="get-cell">
<h3>get_cell<a class="headerlink" href="#get-cell" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="db-save">
<h3>db_save<a class="headerlink" href="#db-save" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="pyg.mongo._db_cell.db_save">
<code class="sig-prename descclassname">pyg.mongo._db_cell.</code><code class="sig-name descname">db_save</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_save" title="Permalink to this definition">¶</a></dt>
<dd><p>saves a db_cell from the database. Will iterates through lists and dicts</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>value: obj</dt><dd><p>db_cell (or list/dict of) to be loaded</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">mongo_table</span><span class="p">,</span> <span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">pk</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">add_</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="n">db</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">db_save</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>    
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">get_cell</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="db-load">
<h3>db_load<a class="headerlink" href="#db-load" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="pyg.mongo._db_cell.db_load">
<code class="sig-prename descclassname">pyg.mongo._db_cell.</code><code class="sig-name descname">db_load</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em>, <em class="sig-param"><span class="n">mode</span><span class="o">=</span><span class="default_value">0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_load" title="Permalink to this definition">¶</a></dt>
<dd><p>loads a db_cell from the database. Iterates through lists and dicts</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>value: obj</dt><dd><p>db_cell (or list/dict of) to be loaded</p>
</dd>
<dt>mode: int</dt><dd><p>loading mode -1: dont load, +1: load and throw an exception if not found, 0: load if found</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="db-ref">
<h3>db_ref<a class="headerlink" href="#db-ref" title="Permalink to this headline">¶</a></h3>
<dl class="py function">
<dt id="pyg.mongo._db_cell.db_ref">
<code class="sig-prename descclassname">pyg.mongo._db_cell.</code><code class="sig-name descname">db_ref</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#pyg.mongo._db_cell.db_ref" title="Permalink to this definition">¶</a></dt>
<dd><p>db_ref strips a db_cell so that it contains only the reference needed to its location in the database.
When we save OTHER cells, referencing this cell, we apply db_ref and only save the bare data needed to reload cell</p>
<dl class="field-list simple">
<dt class="field-odd">Example</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyg</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">mongo_table</span><span class="p">,</span> <span class="n">table</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">pk</span> <span class="o">=</span> <span class="s1">&#39;key&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">db_cell</span><span class="p">(</span><span class="n">add_</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">db</span> <span class="o">=</span> <span class="n">db</span><span class="p">)()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">c</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">3</span>    
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bare</span> <span class="o">=</span> <span class="n">db_ref</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="s1">&#39;a&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bare</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bare</span> <span class="ow">and</span> <span class="s1">&#39;data&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bare</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reloaded</span> <span class="o">=</span> <span class="n">db_load</span><span class="p">(</span><span class="n">bare</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">reloaded</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">reloaded</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">3</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<dl class="simple">
<dt>value: obj</dt><dd><p>db_cell (or list/dict of) to be made into reference</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pyg</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="base.html">pyg.base</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">pyg.mongo</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#query-generator">Query generator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#q-and-q">q and Q</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tables-in-mongo">Tables in Mongo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mongo-cursor">mongo_cursor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mongo-reader">mongo_reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mongo-pk-reader">mongo_pk_reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mongo-pk-cursor">mongo_pk_cursor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#encoding-docs-before-saving-to-mongo">encoding docs before saving to mongo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parquet-write">parquet_write</a></li>
<li class="toctree-l3"><a class="reference internal" href="#csv-write">csv_write</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cells-in-mongo">cells in Mongo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#db-cell">db_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#periodic-cell">periodic_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#get-cell">get_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="#db-save">db_save</a></li>
<li class="toctree-l3"><a class="reference internal" href="#db-load">db_load</a></li>
<li class="toctree-l3"><a class="reference internal" href="#db-ref">db_ref</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="timeseries.html">pyg.timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_dict.html">pyg.base.Dict</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_dictable.html">pyg.base.dictable</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_mongo.html">pyg.mongo</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_cell.html">pyg.base.cell</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_perdictable.html">pyg.base.join</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_timeseries.html">pyg.timeseries</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_ts_decorators.html">pyg.timeseries decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab/tutorial_ts_ewma_time.html">pyg.timeseries.ewma</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="base.html" title="previous chapter">pyg.base</a></li>
      <li>Next: <a href="timeseries.html" title="next chapter">pyg.timeseries</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Yoav Git.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/mongo.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>